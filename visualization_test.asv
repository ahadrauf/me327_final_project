clear; clc;
format compact;

%% Define dimensions and helper variables
% Global parameters
easiness_factor = 1.5;

% Camera Parameters
INCH_TO_METERS = 0.0254;
% camera_params = [958.9126, 956.1364, 957.4814, 557.8223]  % from matlab calibration, 1920x1080
% camera_params = [443.8266, 443.4999, 320.3827, 247.3580]  % from matlab calibration, 640x480
% camera_params = [233.4269, 232.5352, 214.9525, 123.1879]  % from matlab calibration, 424x240
camera_params = [263.5568, 269.5951, 179.0278, 147.3135];  % from matlab calibration, 352x288
tag_size = 3*INCH_TO_METERS;
swap = [0 0 1; -1 0 0; 0 -1 0];

% Dimensions
thickness = 0.02*2;  % thickness of wand
ring_r_inner = 0.075/2*easiness_factor;  % inner radius of the ring (m)
ring_r_outer = 0.045*easiness_factor;  % outer radius of the ring (m)
handle_length = 0.130;  % handle length
handle_width = 0.03;  % handle width

N_ring = 15;
ring_r_avg = (ring_r_outer + ring_r_inner)/2;
ring_pts = zeros(N_ring, 3);
ring_pts(:,1) = ring_r_avg*cos(linspace(0, 2*pi, N_ring));
ring_pts(:,2) = ring_r_avg*sin(linspace(0, 2*pi, N_ring));
handle_pts = [ring_r_inner, 0, 0; ring_r_outer + handle_length, 0, 0];

N_curve = 100;
curve = generate_curve(0.25, 1.5, N_curve);
curve_midpoints = (curve(2:end, :) + curve(1:end-1, :))/2;

%% Plotting
plot3(ring_pts(:,1), ring_pts(:,2), ring_pts(:,3), 'LineWidth', 3);
hold on;
plot3(curve(:,1), curve(:,2), curve(:,3), 'LineWidth', 3);
xlabel("X");
ylabel("Y");
zlabel("Z");
view([30, 45]);  % [az, el]
% view([95, 5])  % [az, el] (view2)

% for i=1:10000
%     
% end

%% Data functions
function [curve] = generate_curve(xmin, xmax, Nspline)
    curve = zeros(Nspline, 3);
    x_range = linspace(xmin, xmax, Nspline);
    z = @(x) 0.05*(sin(4*x) + cos(7*x));
    for i=1:length(x_range)
        curve(i,:) = [x_range(i), 0, z(x_range(i))];
    end
end

function [ring_pts, handle_pts] = draw_wand(pos, R)
    
end